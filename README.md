# ИДЗ 4

**Выполнил:** Тимергалин Тимур Маратович, БПИ 227

Предполагаемая оценка: 9

## Условие

Задача о курильщиках. Есть три процесса–курильщика и один процесс–посредник. Курильщик непрерывно скручивает сигареты и курит их. Чтобы скрутить сигарету, нужны табак, бумага и спички. У одного курильщика есть табак, у второго — бумага, а у третьего – спички. Посредник через некоторое случайное время кладет на стол по два разных случайных компонента. Тот Курильщик, у которого есть третий компонент, забирает компоненты со стола, скручивает сигарету и курит некоторое случайное время. Посредник через отведенный ему интервал времени, который может быть больше или меньше времени курения, выкладывает следующий набор. Если курильщик, которому нужен этот набор, свободен, то он начинает курить. Если курильщик еще курит, то процесс передачи дожидается окончания курения. Затем процесс повторяется. В принципе возможна ситуация, когда все три курильщика могут курить одновременно или все могут ждать, когда посредник соизволит выложить очередной набор. Создать клиент–серверное приложение, моделирующее поведение курильщиков и посредника. Каждый курильщик — клиент. Посредник — сервер.

## Решение

### Исполняемые единицы

- `server` - основной сервер
- `smoker` - клиент курильщика
- `producer` - клиент производителя
- `logger` - отображающий информацию о работе системы

### Запуск

#### На оценку 4-5

```
./server <port>
./smoker <res-id> <server-ip> <server-port>
./producer <server-ip> <server-port>
```

#### На оценку 6-7

```
./logger <port> n [<output-file-name>]
./server <port> <logger-ip> <logger-port>
./smoker <res-id> <server-ip> <server-port> <logger-ip> <logger-port>
./producer <server-ip> <server-port> <logger-ip> <logger-port>
```

#### На оценку 8-9

```
./logger b [<output-file-name>]
./server <port> <broadcast-ip> <logger-port> -b
./smoker <res-id> <server-ip> <server-port> <broadcast-ip> <logger-port> -b
./producer <server-ip> <server-port> <broadcast-ip> <logger-port> -b
```

### Структура

```
│   constants.h  // Константы
│   inet_utils.cpp  // Функции-обертки над системными вызовами
│   inet_utils.h  
│   parse_short.cpp  // Функция для чтения значений портов из командной строки 
│   parse_short.h
│
├───clients // Реализация клиентов
│       logger.cpp
│       producer.cpp
│       smoker.cpp
│
├───out  // Реализации вывода
│       Out.cpp
│       Out.h
│       StreamOut.cpp  // Вывод в консоль
│       UdpOut.cpp  // Вывод клиенту-логгеру
│
└───server  // Реализация сервера
        handler.cpp
        handler.h
        main.cpp
        server.cpp
        server.h
```

